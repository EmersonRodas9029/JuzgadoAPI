<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Expedientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes click-bounce {
            0%   { transform: scale(0.97) rotate(0deg); }
            50%  { transform: scale(0.94) rotate(-3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .animate-fade-in-down {
            animation: fade-in-down 0.6s ease-out;
        }

        .btn-click {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-click:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-click:active {
            animation: click-bounce 0.3s ease forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen p-8 font-sans">

<div class="max-w-7xl mx-auto bg-white/90 backdrop-blur-md shadow-xl rounded-2xl p-8 space-y-6 animate-fade-in-down">

    <!-- Encabezado -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-blue-900">Listado de Expedientes</h1>
            <p class="text-blue-700 italic text-sm">Juzgado Segundo de lo Civil y Mercantil · El Salvador</p>
        </div>
        <a th:href="@{/expedientes/nuevo}"
           class="btn-click bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md"
           title="Crear nuevo expediente">
            <i class="fas fa-plus-circle mr-2"></i> Nuevo Expediente
        </a>
    </div>

    <!-- Formulario de búsqueda -->
    <form action="#" method="get" class="flex items-center gap-4">
        <label for="numero" class="text-blue-800 font-medium">Buscar por Número:</label>
        <input type="text" id="numero" name="numero"
               class="px-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring focus:ring-blue-400 w-64"
               placeholder="Ej. 0000-00-AA">
        <button type="submit"
                class="btn-click bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md">
            <i class="fas fa-search mr-1"></i> Buscar
        </button>
    </form>

    <!-- Condición para verificar si hay expedientes encontrados -->
    <div th:if="${expedientes != null and not #lists.isEmpty(expedientes)}">
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm text-blue-900 border border-blue-200 rounded-lg">
                <thead>
                <tr class="bg-blue-200 text-blue-800 uppercase text-xs tracking-wider">
                    <th class="px-4 py-3">Número De Expediente</th>
                    <th class="px-4 py-3 w-64">Descripción</th>
                    <th class="px-4 py-3">Fecha</th>
                    <th class="px-4 py-3">Caja</th>
                    <th class="px-4 py-3">Bodega</th>
                    <th class="px-4 py-3">Creador</th>
                    <th class="px-4 py-3 text-center">Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="exp : ${expedientes}" class="even:bg-blue-50 odd:bg-white border-b border-blue-100 hover:bg-blue-100 transition animate-fade-in-down">
                    <td class="px-4 py-3" th:text="${exp.numero}">N°</td>
                    <td class="px-4 py-3 break-words max-w-xs" th:text="${exp.descripcion}">Descripción</td>
                    <td class="px-4 py-3" th:text="${exp.fecha}">Fecha</td>
                    <td class="px-4 py-3" th:text="${exp.ubicacionFisica}">Ubicación</td>
                    <td class="px-4 py-3" th:text="${exp.creadoPor}">Usuario</td>
                    <td class="px-4 py-3" th:text="${exp.bodega}">Bodega</td>
                    <td class="px-4 py-3 text-center space-x-3">
                        <a th:href="@{/expedientes/editar/{id}(id=${exp.id})}"
                           class="btn-click bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md"
                           title="Editar expediente">
                            <i class="fas fa-pencil-alt mr-1"></i> Editar
                        </a>
                        <button type="button"
                                th:attr="data-url=@{/expedientes/eliminar/{id}(id=${exp.id})}"
                                onclick="confirmarEliminacion(this)"
                                class="btn-click bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow-md"
                                title="Eliminar expediente">
                            <i class="fas fa-trash-alt mr-1"></i> Eliminar
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Mensaje si no se encontraron resultados -->
    <div th:if="${expedientes == null or #lists.isEmpty(expedientes)}" class="text-center text-xl text-red-600">
        No se encontraron expedientes con ese número.
    </div>

    <!-- Footer -->
    <div class="text-center text-xs text-blue-600 italic pt-4">
        © 2025 Juzgado Segundo de lo Civil y Mercantil · El Salvador <br>
        © Desarrollado por Emerson Rodas y Mario Galdamez
    </div>
</div>

<!-- Modal de confirmación -->
<div id="modalConfirmacion" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full space-y-4 animate-fade-in-down">
        <h2 class="text-xl font-semibold text-red-700">¿Eliminar expediente?</h2>
        <p class="text-gray-700">Esta acción no se puede deshacer. ¿Estás seguro que deseas eliminar este expediente?</p>
        <div class="flex justify-end gap-3 pt-2">
            <button onclick="cerrarModal()" class="btn-click bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg">
                Cancelar
            </button>
            <a id="btnConfirmarEliminar" href="#" class="btn-click bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                Sí, eliminar
            </a>
        </div>
    </div>
</div>

<script>
    function confirmarEliminacion(boton) {
        const url = boton.getAttribute('data-url');
        console.log("URL a eliminar:", url); // para depuración
        document.getElementById('btnConfirmarEliminar').setAttribute('href', url);
        const modal = document.getElementById('modalConfirmacion');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function cerrarModal() {
        const modal = document.getElementById('modalConfirmacion');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
</script>

</body>
</html>
